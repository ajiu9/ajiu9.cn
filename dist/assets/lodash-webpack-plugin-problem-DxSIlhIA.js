import{u as e,_ as n}from"./WrapperPost.vue_vue_type_script_setup_true_lang-ZhkN0tvF.js";import{o as i,c as p,w as r,a as s,b as a}from"./app-BqE1l9fX.js";const h="/images/20240411170613.png",g=s("div",{class:"prose m-auto slide-enter-content"},[s("blockquote",null,[s("p",null,"今天同事在开发环境运行时候，发现lodash的cloneDeep方法返回的数组对象是同一个对象，没有进行深拷贝，这种反直觉的行为必然是发生了什么。")]),s("p",null,[a("首先我想到的是是否是全局参数配置引起的，我看了"),s("a",{href:"https://lodash.com/docs/4.17.15#cloneDeep",target:"_blank",rel:"noopener"},"deepClone"),a("的文档,发现只有一个入参。")]),s("p",null,[a("然后我看了下"),s("a",{href:"https://github.com/lodash/lodash/blob/main/src/cloneDeep.ts",target:"_blank",rel:"noopener"},"源码"),a("，也没有可以配置的参数。")]),s("pre",{class:"shiki shiki-themes github-light github-dark",style:{"--s-light":"#24292e","--s-dark":"#e1e4e8","--s-light-bg":"#fff","--s-dark-bg":"#24292e"},tabindex:"0"},[s("code",{class:"language-js"},[s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"import"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," baseClone "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"from"),s("span",{style:{"--s-light":"#032F62","--s-dark":"#9ECBFF"}}," './.internal/baseClone.js'")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}},"/** Used to compose bitmasks for cloning. */")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"const"),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}}," CLONE_DEEP_FLAG"),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}}," ="),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}}," 1")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"const"),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}}," CLONE_SYMBOLS_FLAG"),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}}," ="),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}}," 4")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}},"/**")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," * This method is like `clone` except that it recursively clones `value`.")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," * Object inheritance is preserved.")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," *")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," * "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"@since"),s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," 1.0.0")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," * "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"@category"),s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," Lang")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," * "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"@param"),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}}," {*}"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," value"),s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," The value to recursively clone.")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," * "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"@returns"),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}}," {*}"),s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," Returns the deep cloned value.")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," * "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"@see"),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}}," clone")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," * "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"@example")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," *")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," * const objects = [{ 'a': 1 }, { 'b': 2 }]")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," *")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," * const deep = cloneDeep(objects)")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," * console.log(deep[0] === objects[0])")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," * // => false")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," */")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"function"),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}}," cloneDeep"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"("),s("span",{style:{"--s-light":"#E36209","--s-dark":"#FFAB70"}},"value"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},") {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"  return"),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}}," baseClone"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"(value, "),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}},"CLONE_DEEP_FLAG"),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}}," |"),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}}," CLONE_SYMBOLS_FLAG"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},")")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"}")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"export"),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}}," default"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," cloneDeep")])])]),s("p",null,"没找到问题所在，我调试了下面这段代码"),s("pre",{class:"shiki shiki-themes github-light github-dark",style:{"--s-light":"#24292e","--s-dark":"#e1e4e8","--s-light-bg":"#fff","--s-dark-bg":"#24292e"},tabindex:"0"},[s("code",{class:"language-js"},[s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"import"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," { cloneDeep } "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"from"),s("span",{style:{"--s-light":"#032F62","--s-dark":"#9ECBFF"}}," 'lodash'")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"const"),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}}," test1"),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}}," ="),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," [{ id: "),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}},"1"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},", name: "),s("span",{style:{"--s-light":"#032F62","--s-dark":"#9ECBFF"}},"'测试1'"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," }]")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"const"),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}}," deep"),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}}," ="),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}}," cloneDeep"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"(test1)")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"console."),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}},"log"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"(deep["),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}},"0"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"] "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"==="),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," test1["),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}},"0"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"]) "),s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}},"// true")])])]),s("p",null,[s("img",{src:h,alt:"image"})]),s("p",null,[a("发现原本"),s("code",null,"cloneDeep"),a("依赖了"),s("code",null,"baseClone"),a("函数，但是却变成了"),s("a",{href:"https://lodash.com/docs/4.17.15#identity",target:"_blank",rel:"noopener"},"identity"),a("这个函数就是返回函数的第一个参数。")]),s("pre",{class:"shiki shiki-themes github-light github-dark",style:{"--s-light":"#24292e","--s-dark":"#e1e4e8","--s-light-bg":"#fff","--s-dark-bg":"#24292e"},tabindex:"0"},[s("code",{class:"language-js"},[s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}},"/**")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," * This method returns the first argument it receives.")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," *")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," * "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"@static")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," * "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"@since"),s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," 0.1.0")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," * "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"@memberOf"),s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," _")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," * "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"@category"),s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," Util")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," * "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"@param"),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}}," {*}"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," value"),s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," Any value.")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," * "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"@returns"),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}}," {*}"),s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," Returns `value`.")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," * "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"@example")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," *")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," * var object = { 'a': 1 };")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," *")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," * console.log(_.identity(object) === object);")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," * // => true")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}}," */")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"function"),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}}," identity"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"("),s("span",{style:{"--s-light":"#E36209","--s-dark":"#FFAB70"}},"value"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},") {")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"  return"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," value")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"}")])])]),s("p",null,"原因找到了，是怎么引起的呢？"),s("p",null,[a("网上搜到了这篇文章"),s("a",{href:"https://zhuanlan.zhihu.com/p/349260482",target:"_blank",rel:"noopener"},"为什么你应该立即停止使用 lodash-webpack-plugin")]),s("p",null,[a("原来是"),s("a",{href:"https://github.com/lodash/lodash-webpack-plugin",target:"_blank",rel:"noopener"},"lodash-webpack-plugin"),a("插件搞出来的。")]),s("p",null,"通过用 noop、identity 或更简单的替代方案替换模块的功能集来创建更小的 Lodash 构建。该插件通过进一步缩小精选的构建来补充 babel-plugin-lodash！ 在未启用适当功能集的情况下使用此插件可能会导致 lodash 函数以意想不到的方式运行。方法可能看起来有效，但它们可能返回不正确的结果，其中就包括克隆函数。"),s("p",null,"最后看了下生产构建，生产没有引用到这个插件，所以没发现影响。开发环境去掉这个插件。")],-1),A={__name:"lodash-webpack-plugin-problem",setup(d){const l={title:"排除一个在开发环境下Lodash的问题",date:"2024-04-11T00:00:00.000Z",type:"blog",lang:"zh",image:"https://ajiu9.cn/og/lodash-webpack-plugin-problem.png",meta:[{property:"og:title",content:"排除一个在开发环境下Lodash的问题"},{name:"twitter:title",content:"排除一个在开发环境下Lodash的问题"},{property:"og:image",content:"https://ajiu9.cn/og/lodash-webpack-plugin-problem.png"},{name:"twitter:image",content:"https://ajiu9.cn/og/lodash-webpack-plugin-problem.png"},{name:"twitter:card",content:"summary_large_image"}]};return e({title:"排除一个在开发环境下Lodash的问题",meta:[{property:"og:title",content:"排除一个在开发环境下Lodash的问题"},{name:"twitter:title",content:"排除一个在开发环境下Lodash的问题"},{property:"og:image",content:"https://ajiu9.cn/og/lodash-webpack-plugin-problem.png"},{name:"twitter:image",content:"https://ajiu9.cn/og/lodash-webpack-plugin-problem.png"},{name:"twitter:card",content:"summary_large_image"}]}),(c,k)=>{const t=n;return i(),p(t,{frontmatter:l},{default:r(()=>[g]),_:1})}}};export{A as default};
