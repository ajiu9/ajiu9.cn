import{u as n,_ as e}from"./WrapperPost.vue_vue_type_script_setup_true_lang-z5U8fOjC.js";import{o as i,c as r,w as E,a as s,b as t}from"./app-DZVM_xCB.js";const p="/images/20240316133018d6be9j.png",d=s("div",{class:"prose m-auto slide-enter-content"},[s("h4",{id:"写在前面",tabindex:"-1"},[t("写在前面 "),s("a",{class:"header-anchor",href:"#写在前面","aria-hidden":"true"},"#")]),s("p",null,"做好错误监控，将用户使用时的错误上报，可以帮助我们定位解决一些出现的问题。本次主要了解一下几个问题：前端错误的分类，每一种分类的错误捕获方式是什么，如何把这些错误上报？"),s("h3",{id:"前端错误分类",tabindex:"-1"},[t("前端错误分类 "),s("a",{class:"header-anchor",href:"#前端错误分类","aria-hidden":"true"},"#")]),s("ul",null,[s("li",null,"即时运行错误：代码错误"),s("li",null,"资源加载错误"),s("li",null,"接口错误 即时运行错误的捕获方式："),s("li",null,[s("code",null,"try..catch")]),s("li",null,[s("code",null,"window.onerror")])]),s("p",null,"资源加载错误的捕获方式："),s("ul",null,[s("li",null,[s("code",null,"object.onerror")]),s("li",null,[s("code",null,"performance.getEntries()")]),s("li",null,[s("code",null,'addEventListener("error",function{}, true)'),t("error事件捕获（资源加载错误不会冒泡，所以window.onerror不能捕获资源加载错误）。")])]),s("p",null,[t("接口错误捕获方式 所有http请求都是基于"),s("code",null,"xmlHttpRequest"),t("或者"),s("code",null,"fetch"),t("封装的。所以要捕获全局的接口错误，方法就是封装xmlHttpRequest或者fetch。 这个捕获可以用状态码作为出错条件处理")]),s("pre",{class:"shiki shiki-themes github-light github-dark",style:{"--s-light":"#24292e","--s-dark":"#e1e4e8","--s-light-bg":"#fff","--s-dark-bg":"#24292e"},tabindex:"0"},[s("code",{class:"language-js"},[s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"function"),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}}," axios"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"() {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"  if"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," ("),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"!"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"window.XMLHttpRequest)")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"    return")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"  const"),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}}," xmlhttp"),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}}," ="),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," window.XMLHttpRequest")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"  _oldSend "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"="),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}}," xmlhttp"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"."),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}},"prototype"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},".send")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"  const"),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}}," _handleEvent"),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}}," ="),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}}," function"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," ("),s("span",{style:{"--s-light":"#E36209","--s-dark":"#FFAB70"}},"event"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},") {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"    if"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," (event "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"&&"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," event.currentTarget "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"&&"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," event.currentTarget.status "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"!=="),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}}," 200"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},") {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}},"      // 自定义错误上报")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"    }")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"  }")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}},"  xmlhttp"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"."),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}},"prototype"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"."),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}},"send"),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}}," ="),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}}," function"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," () {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"    if"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," ("),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}},"this"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},".addEventListener) {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}},"      this"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"."),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}},"addEventListener"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"("),s("span",{style:{"--s-light":"#032F62","--s-dark":"#9ECBFF"}},"'error'"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},", _handleEvent)")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}},"      this"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"."),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}},"addEventListener"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"("),s("span",{style:{"--s-light":"#032F62","--s-dark":"#9ECBFF"}},"'load'"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},", _handleEvent)")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}},"      this"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"."),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}},"addEventListener"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"("),s("span",{style:{"--s-light":"#032F62","--s-dark":"#9ECBFF"}},"'abort'"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},", _handleEvent)")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"    }")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"    else"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"      const"),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}}," _oldStateChange"),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}}," ="),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}}," this"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},".onreadystatechange")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}},"      this"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"."),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}},"onreadystatechange"),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}}," ="),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}}," function"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," ("),s("span",{style:{"--s-light":"#E36209","--s-dark":"#FFAB70"}},"event"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},") {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"        if"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," ("),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}},"this"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},".readyState "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"==="),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}}," 4"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}},"          _handleEvent"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"(event)")]),t(`
`),s("span",{class:"line"}),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"        _oldStateChange "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"&&"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," _oldStateChange."),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}},"apply"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"("),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}},"this"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},", "),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}},"arguments"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"      }")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"    }")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"    return"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," _oldSend."),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}},"apply"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"("),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}},"this"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},", "),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}},"arguments"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"  }")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"}")])])]),s("pre",{class:"shiki shiki-themes github-light github-dark",style:{"--s-light":"#24292e","--s-dark":"#e1e4e8","--s-light-bg":"#fff","--s-dark-bg":"#24292e"},tabindex:"0"},[s("code",{class:"language-js"},[s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"function"),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}}," axios"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"() {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"  if"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," ("),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"!"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"window.fetch)")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"    return")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"  const"),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}}," _oldFetch"),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}}," ="),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," window.fetch")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"  window."),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}},"fetch"),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}}," ="),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}}," function"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," () {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"    return"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," _oldFetch."),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}},"apply"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"("),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}},"this"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},", "),s("span",{style:{"--s-light":"#005CC5","--s-dark":"#79B8FF"}},"arguments"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},")")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"      ."),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}},"then"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"(("),s("span",{style:{"--s-light":"#E36209","--s-dark":"#FFAB70"}},"res"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},") "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"=>"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"        if"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," ("),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"!"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"res.ok) {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}},"          // True if status is HTTP 2xx")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}},"          // 上报错误")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"        }")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"        return"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," res")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"      })")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"      ."),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}},"catch"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"(("),s("span",{style:{"--s-light":"#E36209","--s-dark":"#FFAB70"}},"error"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},") "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"=>"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}}," {")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#6A737D","--s-dark":"#6A737D"}},"        // 上报错误throw error;")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"      })")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"  }")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"}")])])]),s("p",null,"跨域的js运行错误捕获错误提示："),s("p",null,[s("img",{src:p,alt:"图片"})]),s("p",null,"处理方法："),s("ul",null,[s("li",null,"在script标签中增加crossorigin属性。"),s("li",null,"设置js资源响应头Access-Control-Allow-Origin。")]),s("h4",{id:"上报错误的基本原理",tabindex:"-1"},[t("上报错误的基本原理 "),s("a",{class:"header-anchor",href:"#上报错误的基本原理","aria-hidden":"true"},"#")]),s("ul",null,[s("li",null,"采用Ajax通信的方式上报。"),s("li",null,"利用Image对象上报")]),s("p",null,"推荐用Image对象上报错误类型，比Ajax方式简单，并且不用借助任何第三方库。"),s("pre",{class:"shiki shiki-themes github-light github-dark",style:{"--s-light":"#24292e","--s-dark":"#e1e4e8","--s-light-bg":"#fff","--s-dark-bg":"#24292e"},tabindex:"0"},[s("code",{class:"language-js"},[s("span",{class:"line"},[s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"("),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"new"),s("span",{style:{"--s-light":"#6F42C1","--s-dark":"#B392F0"}}," Image"),s("span",{style:{"--s-light":"#24292E","--s-dark":"#E1E4E8"}},"()).src "),s("span",{style:{"--s-light":"#D73A49","--s-dark":"#F97583"}},"="),s("span",{style:{"--s-light":"#032F62","--s-dark":"#9ECBFF"}}," 'http://baidu.com/error?err=error'")])])])],-1),F={__name:"front-end-error-monitoring",setup(h){const a={title:"前端错误监控",lang:"zh",date:"2018-10-18T00:00:00.000Z",type:"note",image:"https://ajiu9.cn/og/front-end-error-monitoring.png",meta:[{property:"og:title",content:"前端错误监控"},{name:"twitter:title",content:"前端错误监控"},{property:"og:image",content:"https://ajiu9.cn/og/front-end-error-monitoring.png"},{name:"twitter:image",content:"https://ajiu9.cn/og/front-end-error-monitoring.png"},{name:"twitter:card",content:"summary_large_image"}]};return n({title:"前端错误监控",meta:[{property:"og:title",content:"前端错误监控"},{name:"twitter:title",content:"前端错误监控"},{property:"og:image",content:"https://ajiu9.cn/og/front-end-error-monitoring.png"},{name:"twitter:image",content:"https://ajiu9.cn/og/front-end-error-monitoring.png"},{name:"twitter:card",content:"summary_large_image"}]}),(y,k)=>{const l=e;return i(),r(l,{frontmatter:a},{default:E(()=>[d]),_:1})}}};export{F as default};
