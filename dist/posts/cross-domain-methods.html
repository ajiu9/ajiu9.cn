<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="author" content="Ajiu9"><meta http-equiv="X-UA-Compatible" content="chrome=1"><meta name="revisit-after" content="7 days"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon.svg" type="image/svg+xml"><link rel="alternate" type="application/rss+xml" title="Ajiu9's Blog" href="/feed.xml"><meta name="msapplication-TileColor" content="#ffffff"><title>前端通信类以及跨域的几种方法</title><script>!function(){var e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("vueuse-color-scheme")||"auto";("dark"===t||e&&"light"!==t)&&document.documentElement.classList.toggle("dark",!0)}()</script><script type="module" crossorigin="" src="/assets/app-CxIlpOwc.js"></script><link rel="stylesheet" crossorigin="" href="/assets/app-BZdLT1WZ.css"><link rel="modulepreload" crossorigin="" href="/assets/cross-domain-methods-C0Tv1rGW.js"><meta property="og:title" content="前端通信类以及跨域的几种方法"><meta name="twitter:title" content="前端通信类以及跨域的几种方法"><meta property="og:image" content="https://ajiu9.cn/og/cross-domain-methods.png"><meta name="twitter:image" content="https://ajiu9.cn/og/cross-domain-methods.png"><meta name="twitter:card" content="summary_large_image"></head><body class="font-sans text-gray-700 dark:text-gray-200 relative"><div id="app" data-server-rendered="true"><!--[--><header class="header z-40" data-v-89b7cfe3=""><a href="/" class="w-12 h-12 absolute xl:fixed m-5 select-none outline-none" focusable="false" data-v-89b7cfe3=""><svg class="svg" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-89b7cfe3="" data-v-6edbdcb7=""><title data-v-6edbdcb7="">Ajiu9</title><mask id="mask0_634_3" style="mask-type:alpha" width="47" height="80" data-v-6edbdcb7=""><path d="M23.5125 22.9252C33.7594 11.9188 21.3168 -4.95774 7.41017 3.11364C-6.49649 11.185 3.75055 40.5355 23.5125 22.9252ZM23.5125 22.9252C79.8707 -24.0356 12.5336 46.4057 12.5336 69.1523C12.5336 91.8989 36.8153 72.5834 16.9251 38.3343" fill="white" data-v-6edbdcb7=""></path></mask><g mask="url(#mask0_634_3)" data-v-6edbdcb7=""><path class="path1" d="M23.5125 22.9252C33.7594 11.9188 21.3168 -4.95774 7.41017 3.11364C-6.49649 11.185 3.75055 40.5355 23.5125 22.9252ZM23.5125 22.9252C79.8707 -24.0356 12.5336 46.4057 12.5336 69.1523C12.5336 91.8989 36.8153 72.5834 16.9251 38.3343" stroke="black" stroke-width="3.5" stroke-linecap="round" data-v-6edbdcb7=""></path></g></svg></a><button title="Scroll to top" fixed="" right-3="" bottom-3="" w-10="" h-10="" hover:op100="" rounded-full="" hover-bg-hex-8883="" transition="" duration-300="" z-100="" print:hidden="" class="op0! pointer-events-none" data-v-89b7cfe3=""><div i-ri-arrow-up-line="" data-v-89b7cfe3=""></div></button><nav class="nav" data-v-89b7cfe3=""><div class="spacer" data-v-89b7cfe3=""></div><div class="right" print:op0="" data-v-89b7cfe3=""><a href="/posts" class="router-link-active" title="Blog" data-v-89b7cfe3=""><span class="lt-md:hidden" data-v-89b7cfe3="">博客</span><div i-ri-article-line="" md:hidden="" data-v-89b7cfe3=""></div></a><a href="/projects" class="" title="Projects" data-v-89b7cfe3=""><span class="lt-md:hidden" data-v-89b7cfe3="">项目</span><div i-ri-lightbulb-line="" class="md:hidden" data-v-89b7cfe3=""></div></a><a href="/photos" class="" title="photos" data-v-89b7cfe3=""><span class="lt-md:hidden" data-v-89b7cfe3="">摄影</span><div i-arcticons:photoncamera="" class="md:hidden" data-v-89b7cfe3=""></div></a><a href="https://github.com/ajiu9" target="_blank" title="GitHub" class="lt-md:hidden" data-v-89b7cfe3=""><div i-uil-github-alt="" data-v-89b7cfe3=""></div></a><a href="/feed.xml" target="_blank" title="RSS" class="lt-md:hidden" data-v-89b7cfe3=""><div i-la-rss-square="" style="font-size:1.25rem;margin:0 -.125rem" data-v-89b7cfe3=""></div></a><a class="select-none" title="Toggle Color Scheme" data-v-89b7cfe3=""><div i-ri-sun-line="" dark:i-ri-moon-line=""></div></a></div></nav></header><main class="px-7 py-10 of-x-hidden"><!--[--><!----><div class="prose m-auto mb-8"><h1 class="mb-0 slide-enter-50">前端通信类以及跨域的几种方法</h1><p class="opacity-50 !-mt-6 slide-enter-50">Sep 27, 2018<!----></p><!----><!----><!----></div><article class=""><!--[--><div class="prose m-auto slide-enter-content"><h4 id="什么是同源策略及限制" tabindex="-1">什么是同源策略及限制 <a class="header-anchor" href="#什么是同源策略及限制" aria-hidden="true">#</a></h4><p>同源策略，它是由Netscape提出的一个著名的安全策略，现在所有支持JavaScript 的浏览器都会使用这个策略。限制从一个源加载的文档或脚本如何与来自另一个源的资源进行交互。这是一个用于隔离潜在恶意文件的关键的安全机制。 所谓同源是指，域名，协议，端口（http协议的默认端口是80）相同。 例如一个浏览器的两个tab页中分别打开来百度和谷歌的页面，当浏览器的百度tab页执行一个脚本的时候会检查这个脚本是属于哪个页面的，即检查是否同源，只有和百度同源的脚本才会被执行。如果非同源，那么在请求数据时，浏览器会在控制台中报一个异常，提示拒绝访问。</p><p>限制：</p><ul><li><p>Cookie、LocalStorage和IndexDB无法获取。</p></li><li><p>无法获取和操作DOM。</p></li><li><p>不能发送Ajax请求。</p></li></ul><h4 id="前后端如何通信" tabindex="-1">前后端如何通信 <a class="header-anchor" href="#前后端如何通信" aria-hidden="true">#</a></h4><ul><li><p>Ajax：同源下的通信方式。</p></li><li><p>WebSocket：不受同源策略的限制，支持跨域。</p></li><li><p>CORS： CORS是跨源资源分享（Cross-Origin Resource Sharing）的缩写。它是W3C标准，是跨源AJAX请求的根本解决方法。相比JSONP只能发GET请求，CORS允许任何类型的请求。</p></li></ul><h4 id="如何创建ajax" tabindex="-1">如何创建Ajax <a class="header-anchor" href="#如何创建ajax" aria-hidden="true">#</a></h4><p>需要知道以下几点：</p><ul><li><p>XMLHttpRequest的工作原理</p></li><li><p>兼容性处理（XMLHttpRequest只在高版本的浏览器支持）</p></li><li><p>事件的触发条件</p></li><li><p>事件的触发顺序</p></li></ul><pre class="shiki shiki-themes github-light github-dark" style="--s-light:#24292e;--s-dark:#e1e4e8;--s-light-bg:#fff;--s-dark-bg:#24292e" tabindex="0"><code class="language-js"><span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">util.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">ajax</span><span style="--s-light:#D73A49;--s-dark:#F97583"> =</span><span style="--s-light:#D73A49;--s-dark:#F97583"> function</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> (</span><span style="--s-light:#E36209;--s-dark:#FFAB70">options</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">  const</span><span style="--s-light:#005CC5;--s-dark:#79B8FF"> opt</span><span style="--s-light:#D73A49;--s-dark:#F97583"> =</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> Object.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">assin</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">({</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">    url: </span><span style="--s-light:#032F62;--s-dark:#9ECBFF">''</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">,</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">    ype: </span><span style="--s-light:#032F62;--s-dark:#9ECBFF">'get'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">,</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">    data: {},</span></span>
<span class="line"><span style="--s-light:#6F42C1;--s-dark:#B392F0">    success</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">() {},</span></span>
<span class="line"><span style="--s-light:#6F42C1;--s-dark:#B392F0">    error</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">() {},</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  }, options)</span></span>
<span class="line"></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">  if</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> (opt.url) {</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">    // 兼容性处理</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">    const</span><span style="--s-light:#005CC5;--s-dark:#79B8FF"> xhr</span><span style="--s-light:#D73A49;--s-dark:#F97583"> =</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> XMLHttpRequest</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">      ?</span><span style="--s-light:#D73A49;--s-dark:#F97583"> new</span><span style="--s-light:#6F42C1;--s-dark:#B392F0"> XMLHttpRequest</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">()</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">      :</span><span style="--s-light:#D73A49;--s-dark:#F97583"> new</span><span style="--s-light:#6F42C1;--s-dark:#B392F0"> ActiveXObject</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">'Microsoft.XMLHTTP'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">    const</span><span style="--s-light:#005CC5;--s-dark:#79B8FF"> data</span><span style="--s-light:#D73A49;--s-dark:#F97583"> =</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> opt.data</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">    let</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> url </span><span style="--s-light:#D73A49;--s-dark:#F97583">=</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> opt.url</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">    const</span><span style="--s-light:#005CC5;--s-dark:#79B8FF"> type</span><span style="--s-light:#D73A49;--s-dark:#F97583"> =</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> opt.type.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">toUpperCase</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">()</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">    const</span><span style="--s-light:#005CC5;--s-dark:#79B8FF"> dataArr</span><span style="--s-light:#D73A49;--s-dark:#F97583"> =</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> []</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">    for</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> (</span><span style="--s-light:#D73A49;--s-dark:#F97583">const</span><span style="--s-light:#005CC5;--s-dark:#79B8FF"> k</span><span style="--s-light:#D73A49;--s-dark:#F97583"> in</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> data)</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">      dataArr.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">push</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">`${</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">k</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">}=${</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">data</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">[</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">k</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">]</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">}`</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">    if</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> (type </span><span style="--s-light:#D73A49;--s-dark:#F97583">===</span><span style="--s-light:#032F62;--s-dark:#9ECBFF"> 'GET'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">      url </span><span style="--s-light:#D73A49;--s-dark:#F97583">=</span><span style="--s-light:#032F62;--s-dark:#9ECBFF"> `${</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">url</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">}?${</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">dataArr</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">join</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">(</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">'&amp;'</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">)</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">}`</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">      xhr.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">open</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(type, url.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">replace</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">/</span><span style="--s-light:#22863A;--s-dark:#85E89D;--s-light-font-weight:bold;--s-dark-font-weight:bold">\?</span><span style="--s-light:#D73A49;--s-dark:#F97583">$</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">/</span><span style="--s-light:#D73A49;--s-dark:#F97583">g</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">, </span><span style="--s-light:#032F62;--s-dark:#9ECBFF">''</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">), </span><span style="--s-light:#005CC5;--s-dark:#79B8FF">true</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">      xhr.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">send</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">()</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">    if</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> (type </span><span style="--s-light:#D73A49;--s-dark:#F97583">===</span><span style="--s-light:#032F62;--s-dark:#9ECBFF"> 'POST'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">      xhr.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">open</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(type, url, </span><span style="--s-light:#005CC5;--s-dark:#79B8FF">true</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">      xmlhttp.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">setRequestHeader</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">'Content-type'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">, </span><span style="--s-light:#032F62;--s-dark:#9ECBFF">'application/x-www-form-urlencoded'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">      xhr.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">send</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(dataArr.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">join</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">'&amp;'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">))</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">    xhr.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">onload</span><span style="--s-light:#D73A49;--s-dark:#F97583"> =</span><span style="--s-light:#D73A49;--s-dark:#F97583"> function</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> () {</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">      if</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> (xhr.status </span><span style="--s-light:#D73A49;--s-dark:#F97583">===</span><span style="--s-light:#005CC5;--s-dark:#79B8FF"> 200</span><span style="--s-light:#D73A49;--s-dark:#F97583"> ||</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> xhr </span><span style="--s-light:#D73A49;--s-dark:#F97583">===</span><span style="--s-light:#005CC5;--s-dark:#79B8FF"> 304</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">        var</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> res</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">        if</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> (opt.success </span><span style="--s-light:#D73A49;--s-dark:#F97583">&amp;&amp;</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> opt.success </span><span style="--s-light:#D73A49;--s-dark:#F97583">instanceof</span><span style="--s-light:#6F42C1;--s-dark:#B392F0"> Function</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">          res </span><span style="--s-light:#D73A49;--s-dark:#F97583">=</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> xhr.responseText</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">          if</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> (</span><span style="--s-light:#D73A49;--s-dark:#F97583">typeof</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> res </span><span style="--s-light:#D73A49;--s-dark:#F97583">===</span><span style="--s-light:#032F62;--s-dark:#9ECBFF"> 'string'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">            res </span><span style="--s-light:#D73A49;--s-dark:#F97583">=</span><span style="--s-light:#005CC5;--s-dark:#79B8FF"> JSON</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">parse</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(res)</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">            opt.success.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">call</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(xhr, res)</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">          }</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">      }</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">      else</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">        if</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> (opt.error </span><span style="--s-light:#D73A49;--s-dark:#F97583">&amp;&amp;</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> opt.error </span><span style="--s-light:#D73A49;--s-dark:#F97583">instanceof</span><span style="--s-light:#6F42C1;--s-dark:#B392F0"> Function</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">          opt.error.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">call</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(xhr, res)</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">      }</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">}</span></span></code></pre><h4 id="跨域通信的几种方式" tabindex="-1">跨域通信的几种方式 <a class="header-anchor" href="#跨域通信的几种方式" aria-hidden="true">#</a></h4><ul><li>jsonp</li><li>Hash</li><li>webSocket</li><li>postMessage</li><li>CORS</li></ul><p><strong>1.jsonp</strong> jsonp原理： 通过<code>&lt;script&gt;</code>标签的异步加载来实现。例如在<code>&lt;head&gt;</code>标签中通过<code>&lt;script&gt;</code>中的url加载的js。</p><pre class="shiki shiki-themes github-light github-dark" style="--s-light:#24292e;--s-dark:#e1e4e8;--s-light-bg:#fff;--s-dark-bg:#24292e" tabindex="0"><code class="language-js"><span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">/**</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">* [function 拼接url]</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">* </span><span style="--s-light:#D73A49;--s-dark:#F97583">@param</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">  {[Object]]}</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> data</span><span style="--s-light:#6A737D;--s-dark:#6A737D"> [description]</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">* </span><span style="--s-light:#D73A49;--s-dark:#F97583">@return</span><span style="--s-light:#6F42C1;--s-dark:#B392F0"> {[value=key&amp;value1=key1]}</span><span style="--s-light:#6A737D;--s-dark:#6A737D"> [description]</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">*/</span><span style="--s-light:#D73A49;--s-dark:#F97583">var</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> util </span><span style="--s-light:#D73A49;--s-dark:#F97583">=</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> {}</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">util.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">param</span><span style="--s-light:#D73A49;--s-dark:#F97583"> =</span><span style="--s-light:#D73A49;--s-dark:#F97583"> function</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> (</span><span style="--s-light:#E36209;--s-dark:#FFAB70">data</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">  var</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> url </span><span style="--s-light:#D73A49;--s-dark:#F97583">=</span><span style="--s-light:#032F62;--s-dark:#9ECBFF"> ''</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">  for</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> (</span><span style="--s-light:#D73A49;--s-dark:#F97583">var</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> k </span><span style="--s-light:#D73A49;--s-dark:#F97583">in</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> data) {</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">    let</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> value </span><span style="--s-light:#D73A49;--s-dark:#F97583">=</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> data[k] </span><span style="--s-light:#D73A49;--s-dark:#F97583">!==</span><span style="--s-light:#005CC5;--s-dark:#79B8FF"> undefined</span><span style="--s-light:#D73A49;--s-dark:#F97583"> ?</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> data[k] </span><span style="--s-light:#D73A49;--s-dark:#F97583">:</span><span style="--s-light:#032F62;--s-dark:#9ECBFF"> ''</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">    url </span><span style="--s-light:#D73A49;--s-dark:#F97583">+=</span><span style="--s-light:#032F62;--s-dark:#9ECBFF"> `&amp;${</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">k</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">}=${</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">encodeURIComponent</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">(</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">value</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">)</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">}`</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">  return</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> url </span><span style="--s-light:#D73A49;--s-dark:#F97583">?</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> url.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">substring</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#005CC5;--s-dark:#79B8FF">1</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">) </span><span style="--s-light:#D73A49;--s-dark:#F97583">:</span><span style="--s-light:#032F62;--s-dark:#9ECBFF"> ''</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">}</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">/**</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">  * [function 判断是否为函数]</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">  * </span><span style="--s-light:#D73A49;--s-dark:#F97583">@param</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">  {[type]}</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> source</span><span style="--s-light:#6A737D;--s-dark:#6A737D"> [description]</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">  * </span><span style="--s-light:#D73A49;--s-dark:#F97583">@return</span><span style="--s-light:#6F42C1;--s-dark:#B392F0"> {[type]}</span><span style="--s-light:#6A737D;--s-dark:#6A737D">        [description]</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">  */</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">util.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">isFunction</span><span style="--s-light:#D73A49;--s-dark:#F97583"> =</span><span style="--s-light:#D73A49;--s-dark:#F97583"> function</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> (</span><span style="--s-light:#E36209;--s-dark:#FFAB70">source</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">  return</span><span style="--s-light:#032F62;--s-dark:#9ECBFF"> '[object Function]'</span><span style="--s-light:#D73A49;--s-dark:#F97583"> ===</span><span style="--s-light:#005CC5;--s-dark:#79B8FF"> Object</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">.</span><span style="--s-light:#005CC5;--s-dark:#79B8FF">prototype</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">.toString.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">call</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(source);</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">};</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">/**</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">  * [function 获取一个随机的5位字符串]</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">  * </span><span style="--s-light:#D73A49;--s-dark:#F97583">@param</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">  {[type]}</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> prefix</span><span style="--s-light:#6A737D;--s-dark:#6A737D"> [description]</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">  * </span><span style="--s-light:#D73A49;--s-dark:#F97583">@return</span><span style="--s-light:#6F42C1;--s-dark:#B392F0"> {[type]}</span><span style="--s-light:#6A737D;--s-dark:#6A737D">        [description]</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">  */</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8"> util.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">getName</span><span style="--s-light:#D73A49;--s-dark:#F97583"> =</span><span style="--s-light:#D73A49;--s-dark:#F97583"> function</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> (</span><span style="--s-light:#E36209;--s-dark:#FFAB70">prefix</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">    return</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> prefix </span><span style="--s-light:#D73A49;--s-dark:#F97583">+</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> Math.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">random</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">().</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">toString</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#005CC5;--s-dark:#79B8FF">36</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">).</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">replace</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">/</span><span style="--s-light:#005CC5;--s-dark:#79B8FF">[</span><span style="--s-light:#D73A49;--s-dark:#F97583">^</span><span style="--s-light:#005CC5;--s-dark:#79B8FF">a-z]</span><span style="--s-light:#D73A49;--s-dark:#F97583">+</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">/</span><span style="--s-light:#D73A49;--s-dark:#F97583">g</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">, </span><span style="--s-light:#032F62;--s-dark:#9ECBFF">''</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">).</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">substr</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#005CC5;--s-dark:#79B8FF">0</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">, </span><span style="--s-light:#005CC5;--s-dark:#79B8FF">5</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  };</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">/**</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">  * [function 在页面中注入js脚本]</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">  * </span><span style="--s-light:#D73A49;--s-dark:#F97583">@param</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">  {[type]}</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> url</span><span style="--s-light:#6A737D;--s-dark:#6A737D">     [description]</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">  * </span><span style="--s-light:#D73A49;--s-dark:#F97583">@param</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">  {[type]}</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> charset</span><span style="--s-light:#6A737D;--s-dark:#6A737D"> [description]</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">  * </span><span style="--s-light:#D73A49;--s-dark:#F97583">@return</span><span style="--s-light:#6F42C1;--s-dark:#B392F0"> {[type]}</span><span style="--s-light:#6A737D;--s-dark:#6A737D">         [description]</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">  */</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8"> util.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">createScript</span><span style="--s-light:#D73A49;--s-dark:#F97583"> =</span><span style="--s-light:#D73A49;--s-dark:#F97583"> function</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> (</span><span style="--s-light:#E36209;--s-dark:#FFAB70">url</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">, </span><span style="--s-light:#E36209;--s-dark:#FFAB70">charset</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">  var</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> script </span><span style="--s-light:#D73A49;--s-dark:#F97583">=</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> document.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">createElement</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">'script'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  script.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">setAttribute</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">'type'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">, </span><span style="--s-light:#032F62;--s-dark:#9ECBFF">'text/javascript'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  charset </span><span style="--s-light:#D73A49;--s-dark:#F97583">&amp;&amp;</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> script.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">setAttribute</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">'charset'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">, charset);</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  script.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">setAttribute</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">'src'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">, url);</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  script.async </span><span style="--s-light:#D73A49;--s-dark:#F97583">=</span><span style="--s-light:#005CC5;--s-dark:#79B8FF"> true</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">  return</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> script;</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">};</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">// jsop实现</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">util.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">jsonp</span><span style="--s-light:#D73A49;--s-dark:#F97583"> =</span><span style="--s-light:#D73A49;--s-dark:#F97583"> function</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#E36209;--s-dark:#FFAB70">url</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">, </span><span style="--s-light:#E36209;--s-dark:#FFAB70">data</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">, </span><span style="--s-light:#E36209;--s-dark:#FFAB70">onsuccess</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">, </span><span style="--s-light:#E36209;--s-dark:#FFAB70">onerror</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">, </span><span style="--s-light:#E36209;--s-dark:#FFAB70">charset</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">  // 第一步，全局注册一个callback回调函数</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">  var</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> callbackName </span><span style="--s-light:#D73A49;--s-dark:#F97583">=</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> util.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">getName</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(_callback);</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  window[callbackName] </span><span style="--s-light:#D73A49;--s-dark:#F97583">=</span><span style="--s-light:#D73A49;--s-dark:#F97583"> function</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">    if</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> (onsuccess </span><span style="--s-light:#D73A49;--s-dark:#F97583">&amp;&amp;</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> onsuccess.util.isFunction) {</span></span>
<span class="line"><span style="--s-light:#6F42C1;--s-dark:#B392F0">       onsuccess</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#005CC5;--s-dark:#79B8FF">arguments</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">[</span><span style="--s-light:#005CC5;--s-dark:#79B8FF">0</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">]);</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">  // 第二步 动态创建Script标签</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  url </span><span style="--s-light:#D73A49;--s-dark:#F97583">+=</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> (url.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">indexOf</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">'?'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">) </span><span style="--s-light:#D73A49;--s-dark:#F97583">&lt;</span><span style="--s-light:#005CC5;--s-dark:#79B8FF"> 0</span><span style="--s-light:#D73A49;--s-dark:#F97583"> ?</span><span style="--s-light:#032F62;--s-dark:#9ECBFF"> '?'</span><span style="--s-light:#D73A49;--s-dark:#F97583"> :</span><span style="--s-light:#032F62;--s-dark:#9ECBFF"> '&amp;'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">) </span><span style="--s-light:#D73A49;--s-dark:#F97583">+</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> util.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">param</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(data);</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">  var</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> script </span><span style="--s-light:#D73A49;--s-dark:#F97583">=</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> util.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">createScript</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(url </span><span style="--s-light:#D73A49;--s-dark:#F97583">+</span><span style="--s-light:#032F62;--s-dark:#9ECBFF"> '&amp;callback='</span><span style="--s-light:#D73A49;--s-dark:#F97583"> +</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> callbackName, charset);</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">  // 第三步 发送script请求</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  document.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">getElementsByTagName</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">'head'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">)[</span><span style="--s-light:#005CC5;--s-dark:#79B8FF">0</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">].</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">appendChild</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(script);</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">  // 第四步 监听函数</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  script.onload </span><span style="--s-light:#D73A49;--s-dark:#F97583">=</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> script.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">onreadystatechange</span><span style="--s-light:#D73A49;--s-dark:#F97583"> =</span><span style="--s-light:#D73A49;--s-dark:#F97583"> function</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> () {</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">    if</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> (</span><span style="--s-light:#D73A49;--s-dark:#F97583">!</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">script.readyState </span><span style="--s-light:#D73A49;--s-dark:#F97583">||</span><span style="--s-light:#032F62;--s-dark:#9ECBFF"> /</span><span style="--s-light:#032F62;--s-dark:#DBEDFF">loaded</span><span style="--s-light:#D73A49;--s-dark:#F97583">|</span><span style="--s-light:#032F62;--s-dark:#DBEDFF">complete</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">/</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">test</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(script.readyState)) {</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">      script.onload </span><span style="--s-light:#D73A49;--s-dark:#F97583">=</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> script.onreadystatechange </span><span style="--s-light:#D73A49;--s-dark:#F97583">=</span><span style="--s-light:#005CC5;--s-dark:#79B8FF"> null</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">;</span><span style="--s-light:#6A737D;--s-dark:#6A737D">// 移除该script的 DOM 对象</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">      if</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> (script.parentNode) {</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">        script.parentNode.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">removeChild</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(script);</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">      }</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">    // 删除函数或变量</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">    window[callbackName] </span><span style="--s-light:#D73A49;--s-dark:#F97583">=</span><span style="--s-light:#005CC5;--s-dark:#79B8FF"> null</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">};</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">script.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">onerror</span><span style="--s-light:#D73A49;--s-dark:#F97583"> =</span><span style="--s-light:#D73A49;--s-dark:#F97583"> function</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> () {</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">  if</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> (onerror </span><span style="--s-light:#D73A49;--s-dark:#F97583">&amp;&amp;</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> util.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">isFunction</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(onerror)) {</span></span>
<span class="line"><span style="--s-light:#6F42C1;--s-dark:#B392F0">    onerror</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">();</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">};</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">}</span></span></code></pre><p>实例：</p><pre class="shiki shiki-themes github-light github-dark" style="--s-light:#24292e;--s-dark:#e1e4e8;--s-light-bg:#fff;--s-dark-bg:#24292e" tabindex="0"><code class="language-js"><span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">util.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">jsonp</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">'https://c.y.qq.com/musichall/fcgi-bin/fcg_yqqhomepagerecommend.fcg'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">, {</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  g_tk: </span><span style="--s-light:#005CC5;--s-dark:#79B8FF">5381</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">,</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  inCharset: </span><span style="--s-light:#032F62;--s-dark:#9ECBFF">'utf-8'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">,</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  outCharset: </span><span style="--s-light:#032F62;--s-dark:#9ECBFF">'utf-8'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">,</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  notice: </span><span style="--s-light:#005CC5;--s-dark:#79B8FF">0</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">,</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  format: </span><span style="--s-light:#032F62;--s-dark:#9ECBFF">'jsonp'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">,</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  platform: </span><span style="--s-light:#032F62;--s-dark:#9ECBFF">' h5'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">,</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  uin: </span><span style="--s-light:#005CC5;--s-dark:#79B8FF">0</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">,</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  needNewCode: </span><span style="--s-light:#005CC5;--s-dark:#79B8FF">1</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">}, </span><span style="--s-light:#D73A49;--s-dark:#F97583">function</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> () {</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  console.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">log</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#005CC5;--s-dark:#79B8FF">arguments</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">})</span></span></code></pre><p><strong>2.Hash（片段识别符）</strong> url的<code>#</code>后面的内容就叫Hash。Hash的改变，页面不会刷新。这就是用 Hash 做跨域通信的基本原理(url的?后面的内容叫Search。Search的改变，会导致页面刷新)。 实例： 页面A通过iframe或frame嵌入了跨域页面B。 窗口可以把信息，写入子窗口的片段标识符。</p><pre class="shiki shiki-themes github-light github-dark" style="--s-light:#24292e;--s-dark:#e1e4e8;--s-light-bg:#fff;--s-dark-bg:#24292e" tabindex="0"><code class="language-js"><span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">var</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> src </span><span style="--s-light:#D73A49;--s-dark:#F97583">=</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> originURL </span><span style="--s-light:#D73A49;--s-dark:#F97583">+</span><span style="--s-light:#032F62;--s-dark:#9ECBFF"> '#'</span><span style="--s-light:#D73A49;--s-dark:#F97583"> +</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> data;</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">document.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">getElementById</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">'myIFrame'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">).src </span><span style="--s-light:#D73A49;--s-dark:#F97583">=</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> src;</span></span></code></pre><p>子窗口通过监听hashchange事件得到通知。</p><pre class="shiki shiki-themes github-light github-dark" style="--s-light:#24292e;--s-dark:#e1e4e8;--s-light-bg:#fff;--s-dark-bg:#24292e" tabindex="0"><code class="language-js"><span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">window.onhashchange </span><span style="--s-light:#D73A49;--s-dark:#F97583">=</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> checkMessage;</span></span>
<span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">function</span><span style="--s-light:#6F42C1;--s-dark:#B392F0"> checkMessage</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">() {</span><span style="--s-light:#D73A49;--s-dark:#F97583">var</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> message </span><span style="--s-light:#D73A49;--s-dark:#F97583">=</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> window.location.hash;</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">// ...</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">}</span></span></code></pre><p>同样的，子窗口也可以改变父窗口的片段标识符。</p><pre class="shiki shiki-themes github-light github-dark" style="--s-light:#24292e;--s-dark:#e1e4e8;--s-light-bg:#fff;--s-dark-bg:#24292e" tabindex="0"><code class="language-js"><span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">parent.location.href</span><span style="--s-light:#D73A49;--s-dark:#F97583">=</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> target </span><span style="--s-light:#D73A49;--s-dark:#F97583">+</span><span style="--s-light:#032F62;--s-dark:#9ECBFF"> "#"</span><span style="--s-light:#D73A49;--s-dark:#F97583"> +</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> hash;</span></span></code></pre><p><strong>3.postMessage</strong> HTML5引入了一个全新的API：跨文档通信 API（Cross-document messaging）。这个API为window对象新增了一个window.postMessage方法，允许跨窗口通信，不论这两个窗口是否同源。</p><pre class="shiki shiki-themes github-light github-dark" style="--s-light:#24292e;--s-dark:#e1e4e8;--s-light-bg:#fff;--s-dark-bg:#24292e" tabindex="0"><code class="language-js"><span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">// postMessage</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">// 窗口A(http:A.com)向跨域的窗口B(http:B.com)发送信息B</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">window.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">postMessage</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">'data'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">, </span><span style="--s-light:#032F62;--s-dark:#9ECBFF">'http://B.com'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">// 在窗口B中监听A</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">window.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">addEventListener</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">'message'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">, </span><span style="--s-light:#D73A49;--s-dark:#F97583">function</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> (</span><span style="--s-light:#E36209;--s-dark:#FFAB70">event</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">) {console.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">log</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(event.origin)});</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">// 发送消息的窗口console.log(event.source); </span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">// 消息发向的网址console.log(event.data); </span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">// 消息内容}, false);</span></span></code></pre><p><strong>4.webSocket</strong> WebSocket是一种通信协议，使用ws://（非加密）和wss://（加密）作为协议前缀。该协议不实行同源政策，只要服务器支持，就可以通过它进行跨源通信。</p><pre class="shiki shiki-themes github-light github-dark" style="--s-light:#24292e;--s-dark:#e1e4e8;--s-light-bg:#fff;--s-dark-bg:#24292e" tabindex="0"><code class="language-js"><span class="line"><span style="--s-light:#D73A49;--s-dark:#F97583">var</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> ws </span><span style="--s-light:#D73A49;--s-dark:#F97583">=</span><span style="--s-light:#D73A49;--s-dark:#F97583"> new</span><span style="--s-light:#6F42C1;--s-dark:#B392F0"> webSocket</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">"wss://echo.websocket.org"</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">ws.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">onopen</span><span style="--s-light:#D73A49;--s-dark:#F97583"> =</span><span style="--s-light:#D73A49;--s-dark:#F97583"> function</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#E36209;--s-dark:#FFAB70">evt</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">) {console.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">log</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">"Connection open ..."</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">ws.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">send</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">"Hello WebSockets!"</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">ws.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">onmessage</span><span style="--s-light:#D73A49;--s-dark:#F97583"> =</span><span style="--s-light:#D73A49;--s-dark:#F97583"> function</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#E36209;--s-dark:#FFAB70">evt</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">) {console.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">log</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">( </span><span style="--s-light:#032F62;--s-dark:#9ECBFF">"Received Message: "</span><span style="--s-light:#D73A49;--s-dark:#F97583"> +</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> evt.data);</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">ws.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">close</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">();</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">ws.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">onclose</span><span style="--s-light:#D73A49;--s-dark:#F97583"> =</span><span style="--s-light:#D73A49;--s-dark:#F97583"> function</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#E36209;--s-dark:#FFAB70">evt</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">) {console.</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">log</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">"Connection closed."</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">};</span></span></code></pre><blockquote><p>Websocket【参考资料】<a href="http://www.ruanyifeng.com/blog/2017/05/websocket.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2017/05/websocket.html</a></p></blockquote><p><strong>4.CORS</strong> CORS是一个W3C标准，全称是”跨域资源共享”（Cross-origin resource sharing）。它允许浏览器向跨源服务器，发出XMLHttpRequest请求，从而克服了AJAX只能同源使用的限制。 跨域时，浏览器会拦截Ajax请求，并在http头中加Origin。</p><pre class="shiki shiki-themes github-light github-dark" style="--s-light:#24292e;--s-dark:#e1e4e8;--s-light-bg:#fff;--s-dark-bg:#24292e" tabindex="0"><code class="language-js"><span class="line"><span style="--s-light:#6F42C1;--s-dark:#B392F0">fetch</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#032F62;--s-dark:#9ECBFF">'/some/url/'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">, {</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">  method: </span><span style="--s-light:#032F62;--s-dark:#9ECBFF">'get'</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">,</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">}).</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">then</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#D73A49;--s-dark:#F97583">function</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> (</span><span style="--s-light:#E36209;--s-dark:#FFAB70">response</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">  // 请求成功后执行操作</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">}).</span><span style="--s-light:#6F42C1;--s-dark:#B392F0">catch</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">(</span><span style="--s-light:#D73A49;--s-dark:#F97583">function</span><span style="--s-light:#24292E;--s-dark:#E1E4E8"> (</span><span style="--s-light:#E36209;--s-dark:#FFAB70">err</span><span style="--s-light:#24292E;--s-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="--s-light:#6A737D;--s-dark:#6A737D">  // 请求失败后执行操作</span></span>
<span class="line"><span style="--s-light:#24292E;--s-dark:#E1E4E8">});</span></span></code></pre><p><a href="http://www.ruanyifeng.com/blog/2016/04/cors.html" target="_blank" rel="noopener">CORS【参考资料】</a></p></div><!--]--></article><div class="prose m-auto mt-8 mb-8 slide-enter animate-delay-500 print:hidden"><!----><br><span font-mono="" op50="">&gt; </span><a href="/posts" class="router-link-active font-mono op50 hover:op75"></a></div><!--]--><div class="mt-10 mb-6 prose m-auto flex slide-enter animate-delay-1200!"><span class="text-sm op50">@2024-2025 湘ICP备2024048835号</span><div class="flex-auto"></div></div></main><!----><!--]--></div></body></html>